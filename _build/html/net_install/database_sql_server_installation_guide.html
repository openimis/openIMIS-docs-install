

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Database installation guide &mdash; openIMIS  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Web application installation guide" href="web_app_vb_installation_guide.html" />
    <link rel="prev" title="Minimum requirements" href="minimum_requirements.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> openIMIS
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="minimum_requirements.html">Minimum requirements</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Database installation guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-sql-server">Install SQL Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-sql-server">Configure SQL Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialise-openimis-database">Initialise openIMIS database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upgrade-the-openimis-database">Upgrade the openIMIS database</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web_app_vb_installation_guide.html">Web application installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_service_vb_installation_guide.html">Web service installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows_services_installation_guide.html">Windows services installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_applications_configuration.html">Mobile application configuration guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openIMIS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Database installation guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/net_install/database_sql_server_installation_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="database-installation-guide">
<h1>Database installation guide<a class="headerlink" href="#database-installation-guide" title="Permalink to this headline">¶</a></h1>
<p><strong>v1.3.0</strong></p>
<div class="section" id="install-sql-server">
<h2>Install SQL Server<a class="headerlink" href="#install-sql-server" title="Permalink to this headline">¶</a></h2>
<p>Note: This installation guide is based on SQL Server 2017.</p>
<p>Download the desired version of SQL Server (for example, the Express version from <a class="reference external" href="https://www.microsoft.com/en-us/sql-server/sql-server-downloads">https://www.microsoft.com/en-us/sql-server/sql-server-downloads</a>).</p>
<p>When the installation wizard opens, select the manual configuration option in order to fine tune the installation process.</p>
<p>On the Features selection:</p>
<ul class="simple">
<li>In Shared Feature section, select SQL Client Connectivity SDK</li>
<li>For installations with Data Warehouse, select Analysis Services, Reporting Services and Integration Services (not available for the Express edition)</li>
</ul>
<p>On the Instance configuration, the default name (SQLEXPRESS) can be used, unless it is already used by another instance.</p>
<p>On Database engine configuration, select Mixed Mode (SQL Server authentication and Windows authentication) in Authentication Mode.</p>
<p>Continue the setup process until the installation is complete.</p>
</div>
<div class="section" id="configure-sql-server">
<h2>Configure SQL Server<a class="headerlink" href="#configure-sql-server" title="Permalink to this headline">¶</a></h2>
<p>Open the SQL Server Configuration Manager</p>
<ul class="simple">
<li>On the left panel, select SQL Server Network Configuration → Protocols for SQLEXPRESS (or the name of your SQL Server instance) → Enable Named Pipes and TCP/IP</li>
<li>Select SQL Server Services → right click on SQL server (instance name) and select Restart</li>
</ul>
</div>
<div class="section" id="initialise-openimis-database">
<h2>Initialise openIMIS database<a class="headerlink" href="#initialise-openimis-database" title="Permalink to this headline">¶</a></h2>
<p>To facilitate the setting up of the openIMIS database, it is suggested to install <a class="reference external" href="https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms">SQL Server Management Studio</a> (SSMS). The following procedure is based on SSMS, but you can use the standard SQL Server prompt to proceed with the setup.</p>
<p>First, download the openIMIS database SQL files and migration scripts from Github repository (the source code ZIP file).</p>
<p>In SQL Server Management Studio:</p>
<ul>
<li><p class="first">Create a new database for the openIMIS instance (i.e. openIMIS.X.Y.Z where X.Y.Z is the openIMIS database version).</p>
</li>
<li><p class="first">Execute the initial database creation script provided in the release sources (from the <code class="docutils literal notranslate"><span class="pre">Empty</span> <span class="pre">databases</span></code> folder).</p>
<blockquote>
<div><p>Choose the database to restore based on your context. There are 3 types of databases (structurally identical, but they are pre-configured differently):</p>
<blockquote>
<div><ul class="simple">
<li>Online: this is the default choice when deploying a central online server</li>
<li>Offline: this mode is sometime used for remote insurance offices without connectivity. Note: the synchronisation of data with the central server is manual.</li>
<li>Offline HF: this database can be used in remote health facilities without connectivity. Note: the synchronisation of data with the central server is manual.</li>
</ul>
</div></blockquote>
<p>Restauration can be done in SQL Server Management Studio</p>
<p>or the below command line can be used in a shell</p>
<blockquote>
<div><dl class="docutils">
<dt>Becareful to addapt the querries to your setup, in the command lines example those assumptions were made:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">Online</span></code> database version 1.20 is to be restored</li>
<li>The database is called <code class="docutils literal notranslate"><span class="pre">IMIS_DATABASENAME</span></code></li>
<li>The SQL server is called <code class="docutils literal notranslate"><span class="pre">SQL_Server_Name</span></code></li>
</ul>
</dd>
</dl>
<div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E -S SQL_Server_Name –Q <span class="s2">&quot;RESTORE DATABASE [IMIS_DATABASENAME] FROM DISK=&#39;X:\PathToBackupFile\openIMIS_ONLINE_v1.2.0.bak&#39;&quot;</span>
</pre></div>
</td></tr></table></div>
<p>In case the database need to be restored on a server that doesn’t have the same file structur as the initial server (e.g. from Windows to Linux), the new location of the mlf/mlf files can be specified</p>
<div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E -S SQL_Server_Name -Q <span class="s2">&quot;RESTORE DATABASE [IMIS_DATABASENAME] FROM DISK=N&#39;/tmp/openIMIS_ONLINE_v1.2.0.bak&#39; WITH MOVE N&#39;CH_CENTRAL&#39; TO &#39;/var/opt/mssql/data/IMIS.mdf&#39;, MOVE N&#39;CH_CENTRAL_log&#39; TO &#39;/var/opt/mssql/data/IMIS_log.ldf&#39;&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Execute the SETUP-IMIS stored procedure</dt>
<dd><p class="first">In SQL Server Management Studio</p>
<blockquote>
<div><ul class="simple">
<li>In the Object Explorer: openIMIS (the openIMIS db name) → Programmability → Stored Procedures → dbo.SETUP-IMIS</li>
<li>Right click on the dbo.SETUP-IMIS and execute the procedure.</li>
</ul>
</div></blockquote>
<p>or run this command in a shell</p>
<blockquote>
<div><div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E -S SQL_Server_Name -d IMIS_DATABASENAME -Q <span class="s2">&quot;EXECUTE [SETUP-IMIS]&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p class="last">The result returned from the procedure should be 0.</p>
</dd>
</dl>
</li>
</ul>
<p>If you prefer to initialize the database using the shell:</p>
<blockquote>
<div><p>Be careful to adapt the queries to your setup, in the command lines example those assumptions were made:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Online</span></code> database is to be initialized</li>
<li>The database is called <code class="docutils literal notranslate"><span class="pre">IMIS_DATABASENAME</span></code></li>
<li>The SQL server is called <code class="docutils literal notranslate"><span class="pre">SQL_Server_Name</span></code></li>
</ul>
</div></blockquote>
<div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E –Q “CREATE DATABASE IMIS_DATABASENAME”
SqlCmd -E -S SQL_Server_Name -d IMIS_DATABASENAME –i X:\PathToSQLFile\openIMIS_ONLINE.sql
</pre></div>
</td></tr></table></div>
</div></blockquote>
<p>Create a dedicated user with full privilege on the openIMIS database only:</p>
<ul>
<li><p class="first">In the Security → Logins → right click and select “New Login…”</p>
</li>
<li><p class="first">In General page:</p>
<blockquote>
<div><ul class="simple">
<li>Give a login name (i.e. ImisUser)</li>
<li>Select SQL Server authentication and provide a password</li>
<li>Unselect Enforce password expiration</li>
<li>Change default database to openIMIS</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">In User Mapping page:</p>
<blockquote>
<div><ul class="simple">
<li>Map IMIS db to ImisUser user</li>
<li>Give the role of db_owner</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="upgrade-the-openimis-database">
<h2>Upgrade the openIMIS database<a class="headerlink" href="#upgrade-the-openimis-database" title="Permalink to this headline">¶</a></h2>
<p>Before updating the database make sure the database is not reachable (off line) for the applications (web, mobile,…).</p>
<p>If you want to update a production instance:</p>
<blockquote>
<div><ul class="simple">
<li>Please duplicate the database (create a full backup of the database)</li>
<li>Execute the steps below on the copy of the database</li>
<li>If the migration script succeeded on the copy, then you can apply the migration script to the production instance.</li>
</ul>
</div></blockquote>
<p>This approach will prevent impacting the production if the migration script failed because of customizations in your openIMIS instance and it will give you an idea of the time required to update the database.</p>
<p>If an existing openIMIS database exists already, follow the next steps to upgrade it to the desired version:</p>
<ul>
<li><p class="first">Do a backup of the database</p>
<p>Use the backup tools available in SQL Server Management Studio</p>
<p>or run this command in a shell</p>
<blockquote>
<div><p>Becareful to addapt the querries to your setup, in the command lines example those assumptions were made:</p>
<blockquote>
<div><ul class="simple">
<li>The database is called <code class="docutils literal notranslate"><span class="pre">IMIS_DATABASENAME</span></code></li>
<li>The SQL server is called <code class="docutils literal notranslate"><span class="pre">SQL_Server_Name</span></code></li>
</ul>
</div></blockquote>
<div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E -S SQL_Server_Name –Q <span class="s2">&quot;BACKUP DATABASE [IMIS_DATABASENAME] TO DISK=&#39;X:PathToBackupLocation\[Name_of_Database].bak&#39;&quot;</span>
</pre></div>
</td></tr></table></div>
</div></blockquote>
</li>
<li><p class="first">Download the openIMIS database SQL files and migration scripts from <a class="reference external" href="https://github.com/openimis/database_ms_sqlserver/releases/latest">Github repository</a> (the source code ZIP file).</p>
</li>
<li><p class="first">In SQL Server Management Studio, run the migration script on the openIMIS database</p>
<p>or using the shell:</p>
<div class="highlight-dosbatch notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SqlCmd -E -S SQL_Server_Name -d IMIS_DATABASENAME –i <span class="s2">&quot;X:\PathToMigrationScript\openIMIS migration v1.2.0 - v1.3.0.sql&quot;</span>
</pre></div>
</td></tr></table></div>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="web_app_vb_installation_guide.html" class="btn btn-neutral float-right" title="Web application installation guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="minimum_requirements.html" class="btn btn-neutral float-left" title="Minimum requirements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, openIMIS team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>